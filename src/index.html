<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paginated Data</title>

    <link rel="stylesheet" href="style.css">
</head>

<body>

    <table>
        <caption>paginated random data of app users</caption>
        <thead>
            <tr>
                <td># No.</td>
                <td>Gender</td>
                <td>Age</td>
            </tr>
        </thead>
        <tbody data-sink class="tableBody"></tbody>
    </table>

    <div class="btn-group">
        <button data-prevbtn class="prev-button" aria-label="Previous page">Previous</button>
        <button data-nextbtn class="next-button" aria-label="Next page">Next</button>
        <label data-pageview class="page-number"></label>
    </div>


    <script type="module" src="app.ts"></script>
    <script>
        const tableBodyClass = document.querySelector('.tableBody')
        const previousButton = document.querySelector('.prev-button')
        const nextButton = document.querySelector('.next-button')
        const pageNumber = document.querySelector('.page-number')
        const baseUrl = 'https://randomapi.com/api/8csrgnjw?key=LEIX-GF3O-AG7I-6J84'

        let currentPage = 1
        const pageSize = 5

        const disableButton = (button) => {
            button.classList.add("disabled");
            button.setAttribute("disabled", true);
        };

        const enableButton = (button) => {
            button.classList.remove("disabled");
            button.removeAttribute("disabled");
        };

        const handlePageButtonsStatus = () => {
            // debugger
            if (currentPage === 1) {
                disableButton(previousButton);
            } else {
                enableButton(previousButton);
            }

            // if (pageCount === currentPage) {
            //     disableButton(nextButton);
            // } else {
            //     enableButton(nextButton);
            // }
        };

        const setCurrentPage = (pageNum) => {
            currentPage = pageNum;
            handlePageButtonsStatus();

            const prevRange = (pageNum - 1) * pageSize;
            const currRange = pageNum * pageSize;
        };

        const fetchData = async (url) => {
            const response = await fetch(url)
            const data = await response.json();
            const { results } = data
            const [tableData]=  results
            const nextPage = tableData.paging.next

           const randomData =  Object.entries(tableData).map(([key, value]) => {
                if(key !== 'paging') {
                   return value
                }
            })
            const mergedData = [].concat.apply([], randomData).filter(item => item !== undefined);

            createTable(mergedData)

            const params = new URLSearchParams(tableData.paging.next)

        }

        const createTable = (tableData) => {
            const tableRow = tableData.map((item) => {
                return `<tr>
                            <td>${item.row}</td>
                            <td>${item.gender.toUpperCase()}</td>
                            <td>${item.age}</td>
                        </tr>`
            }).join('')

            tableBodyClass.insertAdjacentHTML("afterend", tableRow);
            pageNumber.innerHTML = 'Showing Page 1'
        }


        window.addEventListener("load", async () => {
            fetchData(baseUrl)
            setCurrentPage(1);

            previousButton.addEventListener("click", () => {
                setCurrentPage(currentPage - 1);
            });

            nextButton.addEventListener("click", () => {
                setCurrentPage(currentPage + 1);
            });

        });

    </script>
</body>

</html>